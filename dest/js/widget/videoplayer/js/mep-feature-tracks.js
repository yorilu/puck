(function(e){e.extend(mejs.MepDefaults,{startLanguage:"",tracksText:mejs.i18n.t("Captions/Subtitles"),hideCaptionsButtonWhenEmpty:!0,toggleCaptionsButtonWhenOnlyOne:!1,slidesSelector:""}),e.extend(MediaElementPlayer.prototype,{hasChapters:!1,cleartracks:function(e,t,n,r){e&&(e.captions&&e.captions.remove(),e.chapters&&e.chapters.remove(),e.captionsText&&e.captionsText.remove(),e.captionsButton&&e.captionsButton.remove())},buildtracks:function(t,n,r,i){if(t.tracks.length===0)return;var s=this,o,u="";if(s.domNode.textTracks)for(o=s.domNode.textTracks.length-1;o>=0;o--)s.domNode.textTracks[o].mode="hidden";s.cleartracks(t,n,r,i),t.chapters=e('<div class="mejs-chapters mejs-layer"></div>').prependTo(r).hide(),t.captions=e('<div class="mejs-captions-layer mejs-layer"><div class="mejs-captions-position mejs-captions-position-hover" role="log" aria-live="assertive" aria-atomic="false"><span class="mejs-captions-text"></span></div></div>').prependTo(r).hide(),t.captionsText=t.captions.find(".mejs-captions-text"),t.captionsButton=e('<div class="mejs-button mejs-captions-button"><button type="button" aria-controls="'+s.id+'" title="'+s.options.tracksText+'" aria-label="'+s.options.tracksText+'"></button>'+'<div class="mejs-captions-selector">'+"<ul>"+"<li>"+'<input type="radio" name="'+t.id+'_captions" id="'+t.id+'_captions_none" value="none" checked="checked" />'+'<label for="'+t.id+'_captions_none">'+mejs.i18n.t("None")+"</label>"+"</li>"+"</ul>"+"</div>"+"</div>").appendTo(n);var a=0;for(o=0;o<t.tracks.length;o++)t.tracks[o].kind=="subtitles"&&a++;s.options.toggleCaptionsButtonWhenOnlyOne&&a==1?t.captionsButton.on("click",function(){t.selectedTrack===null?lang=t.tracks[0].srclang:lang="none",t.setTrack(lang)}):(t.captionsButton.on("mouseenter focusin",function(){e(this).find(".mejs-captions-selector").css("visibility","visible")}).on("click","input[type=radio]",function(){lang=this.value,t.setTrack(lang)}),t.captionsButton.on("mouseleave focusout",function(){e(this).find(".mejs-captions-selector").css("visibility","hidden")})),t.options.alwaysShowControls?t.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover"):t.container.bind("controlsshown",function(){t.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover")}).bind("controlshidden",function(){i.paused||t.container.find(".mejs-captions-position").removeClass("mejs-captions-position-hover")}),t.trackToLoad=-1,t.selectedTrack=null,t.isLoadingTrack=!1;for(o=0;o<t.tracks.length;o++)t.tracks[o].kind=="subtitles"&&t.addTrackButton(t.tracks[o].srclang,t.tracks[o].label);t.loadNextTrack(),i.addEventListener("timeupdate",function(e){t.displayCaptions()},!1),t.options.slidesSelector!==""&&(t.slidesContainer=e(t.options.slidesSelector),i.addEventListener("timeupdate",function(e){t.displaySlides()},!1)),i.addEventListener("loadedmetadata",function(e){t.displayChapters()},!1),t.container.hover(function(){t.hasChapters&&(t.chapters.css("visibility","visible"),t.chapters.fadeIn(200).height(t.chapters.find(".mejs-chapter").outerHeight()))},function(){t.hasChapters&&!i.paused&&t.chapters.fadeOut(200,function(){e(this).css("visibility","hidden"),e(this).css("display","block")})}),t.node.getAttribute("autoplay")!==null&&t.chapters.css("visibility","hidden")},setTrack:function(e){var t=this,n;if(e=="none")t.selectedTrack=null,t.captionsButton.removeClass("mejs-captions-enabled");else for(n=0;n<t.tracks.length;n++)if(t.tracks[n].srclang==e){t.selectedTrack===null&&t.captionsButton.addClass("mejs-captions-enabled"),t.selectedTrack=t.tracks[n],t.captions.attr("lang",t.selectedTrack.srclang),t.displayCaptions();break}},loadNextTrack:function(){var e=this;e.trackToLoad++,e.trackToLoad<e.tracks.length?(e.isLoadingTrack=!0,e.loadTrack(e.trackToLoad)):(e.isLoadingTrack=!1,e.checkForTracks())},loadTrack:function(t){var n=this,r=n.tracks[t],i=function(){r.isLoaded=!0,n.enableTrackButton(r.srclang,r.label),n.loadNextTrack()};e.ajax({url:r.src,dataType:"text",success:function(e){typeof e=="string"&&/<tt\s+xml/ig.exec(e)?r.entries=mejs.TrackFormatParser.dfxp.parse(e):r.entries=mejs.TrackFormatParser.webvtt.parse(e),i(),r.kind=="chapters"&&n.media.addEventListener("play",function(e){n.media.duration>0&&n.displayChapters(r)},!1),r.kind=="slides"&&n.setupSlides(r)},error:function(){n.loadNextTrack()}})},enableTrackButton:function(t,n){var r=this;n===""&&(n=mejs.language.codes[t]||t),r.captionsButton.find("input[value="+t+"]").prop("disabled",!1).siblings("label").html(n),r.options.startLanguage==t&&e("#"+r.id+"_captions_"+t).prop("checked",!0).trigger("click"),r.adjustLanguageBox()},addTrackButton:function(t,n){var r=this;n===""&&(n=mejs.language.codes[t]||t),r.captionsButton.find("ul").append(e('<li><input type="radio" name="'+r.id+'_captions" id="'+r.id+"_captions_"+t+'" value="'+t+'" disabled="disabled" />'+'<label for="'+r.id+"_captions_"+t+'">'+n+" (loading)"+"</label>"+"</li>")),r.adjustLanguageBox(),r.container.find(".mejs-captions-translations option[value="+t+"]").remove()},adjustLanguageBox:function(){var e=this;e.captionsButton.find(".mejs-captions-selector").height(e.captionsButton.find(".mejs-captions-selector ul").outerHeight(!0)+e.captionsButton.find(".mejs-captions-translations").outerHeight(!0))},checkForTracks:function(){var e=this,t=!1;if(e.options.hideCaptionsButtonWhenEmpty){for(i=0;i<e.tracks.length;i++)if(e.tracks[i].kind=="subtitles"){t=!0;break}t||(e.captionsButton.hide(),e.setControlsSize())}},displayCaptions:function(){if(typeof this.tracks=="undefined")return;var e=this,t,n=e.selectedTrack;if(n!==null&&n.isLoaded){for(t=0;t<n.entries.times.length;t++)if(e.media.currentTime>=n.entries.times[t].start&&e.media.currentTime<=n.entries.times[t].stop){e.captionsText.html(n.entries.text[t]).attr("class","mejs-captions-text "+(n.entries.times[t].identifier||"")),e.captions.show().height(0);return}e.captions.hide()}else e.captions.hide()},setupSlides:function(e){var t=this;t.slides=e,t.slides.entries.imgs=[t.slides.entries.text.length],t.showSlide(0)},showSlide:function(t){if(typeof this.tracks=="undefined"||typeof this.slidesContainer=="undefined")return;var n=this,r=n.slides.entries.text[t],i=n.slides.entries.imgs[t];typeof i=="undefined"||typeof i.fadeIn=="undefined"?n.slides.entries.imgs[t]=i=e('<img src="'+r+'">').on("load",function(){i.appendTo(n.slidesContainer).hide().fadeIn().siblings(":visible").fadeOut()}):!i.is(":visible")&&!i.is(":animated")&&i.fadeIn().siblings(":visible").fadeOut()},displaySlides:function(){if(typeof this.slides=="undefined")return;var e=this,t=e.slides,n;for(n=0;n<t.entries.times.length;n++)if(e.media.currentTime>=t.entries.times[n].start&&e.media.currentTime<=t.entries.times[n].stop){e.showSlide(n);return}},displayChapters:function(){var e=this,t;for(t=0;t<e.tracks.length;t++)if(e.tracks[t].kind=="chapters"&&e.tracks[t].isLoaded){e.drawChapters(e.tracks[t]),e.hasChapters=!0;break}},drawChapters:function(t){var n=this,r,i,s=0,o=0;n.chapters.empty();for(r=0;r<t.entries.times.length;r++){i=t.entries.times[r].stop-t.entries.times[r].start,s=Math.floor(i/n.media.duration*100);if(s+o>100||r==t.entries.times.length-1&&s+o<100)s=100-o;n.chapters.append(e('<div class="mejs-chapter" rel="'+t.entries.times[r].start+'" style="left: '+o.toString()+"%;width: "+s.toString()+'%;">'+'<div class="mejs-chapter-block'+(r==t.entries.times.length-1?" mejs-chapter-block-last":"")+'">'+'<span class="ch-title">'+t.entries.text[r]+"</span>"+'<span class="ch-time">'+mejs.Utility.secondsToTimeCode(t.entries.times[r].start)+"&ndash;"+mejs.Utility.secondsToTimeCode(t.entries.times[r].stop)+"</span>"+"</div>"+"</div>")),o+=s}n.chapters.find("div.mejs-chapter").click(function(){n.media.setCurrentTime(parseFloat(e(this).attr("rel"))),n.media.paused&&n.media.play()}),n.chapters.show()}}),mejs.language={codes:{af:"Afrikaans",sq:"Albanian",ar:"Arabic",be:"Belarusian",bg:"Bulgarian",ca:"Catalan",zh:"Chinese","zh-cn":"Chinese Simplified","zh-tw":"Chinese Traditional",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",et:"Estonian",fl:"Filipino",fi:"Finnish",fr:"French",gl:"Galician",de:"German",el:"Greek",ht:"Haitian Creole",iw:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",ko:"Korean",lv:"Latvian",lt:"Lithuanian",mk:"Macedonian",ms:"Malay",mt:"Maltese",no:"Norwegian",fa:"Persian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sr:"Serbian",sk:"Slovak",sl:"Slovenian",es:"Spanish",sw:"Swahili",sv:"Swedish",tl:"Tagalog",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",cy:"Welsh",yi:"Yiddish"}},mejs.TrackFormatParser={webvtt:{pattern_timecode:/^((?:[0-9]{1,2}:)?[0-9]{2}:[0-9]{2}([,.][0-9]{1,3})?) --\> ((?:[0-9]{1,2}:)?[0-9]{2}:[0-9]{2}([,.][0-9]{3})?)(.*)$/,parse:function(t){var n=0,r=mejs.TrackFormatParser.split2(t,/\r?\n/),i={text:[],times:[]},s,o,u;for(;n<r.length;n++){s=this.pattern_timecode.exec(r[n]);if(s&&n<r.length){n-1>=0&&r[n-1]!==""&&(u=r[n-1]),n++,o=r[n],n++;while(r[n]!==""&&n<r.length)o=o+"\n"+r[n],n++;o=e.trim(o).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>"),i.text.push(o),i.times.push({identifier:u,start:mejs.Utility.convertSMPTEtoSeconds(s[1])===0?.2:mejs.Utility.convertSMPTEtoSeconds(s[1]),stop:mejs.Utility.convertSMPTEtoSeconds(s[3]),settings:s[5]})}u=""}return i}},dfxp:{parse:function(t){t=e(t).filter("tt");var n=0,r=t.children("div").eq(0),i=r.find("p"),s=t.find("#"+r.attr("style")),o,u,a,f,l={text:[],times:[]};if(s.length){var c=s.removeAttr("id").get(0).attributes;if(c.length){o={};for(n=0;n<c.length;n++)o[c[n].name.split(":")[1]]=c[n].value}}for(n=0;n<i.length;n++){var h,p={start:null,stop:null,style:null};i.eq(n).attr("begin")&&(p.start=mejs.Utility.convertSMPTEtoSeconds(i.eq(n).attr("begin"))),!p.start&&i.eq(n-1).attr("end")&&(p.start=mejs.Utility.convertSMPTEtoSeconds(i.eq(n-1).attr("end"))),i.eq(n).attr("end")&&(p.stop=mejs.Utility.convertSMPTEtoSeconds(i.eq(n).attr("end"))),!p.stop&&i.eq(n+1).attr("begin")&&(p.stop=mejs.Utility.convertSMPTEtoSeconds(i.eq(n+1).attr("begin")));if(o){h="";for(var d in o)h+=d+":"+o[d]+";"}h&&(p.style=h),p.start===0&&(p.start=.2),l.times.push(p),f=e.trim(i.eq(n).html()).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>"),l.text.push(f),l.times.start===0&&(l.times.start=2)}return l}},split2:function(e,t){return e.split(t)}},"x\n\ny".split(/\n/gi).length!=3&&(mejs.TrackFormatParser.split2=function(e,t){var n=[],r="",i;for(i=0;i<e.length;i++)r+=e.substring(i,i+1),t.test(r)&&(n.push(r.replace(t,"")),r="");return n.push(r),n})})(mejs.$)