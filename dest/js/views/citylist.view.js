define(["backbone","text!../templates/citylist.tpl.html","puck","modelFactory","utils"],function(e,t,n,r,i){var s=r.get("getCityList"),o=e.View.extend({events:{"click .js_back":"goBack","click #js_cityContainer li":"selectCity","click .js_location":"selectCity"},goBack:function(){n.back()},selectCity:function(e){var t=$(e.currentTarget),r={id:t.attr("data-id"),name:t.attr("data-name")};this.$el.find("#js_cityContainer li").removeClass("check-cut"),this.$el.find(".js_city_"+t.attr("data-id")).addClass("check-cut"),i.Store.set("SMART_SELECTED_CITY",r),n.back(-1,"selected")},requestCityList:function(){var e=this;s.$post({success:function(t){if(t&&t.data&&t.data.length>0){var n=e.formatData(t.data);i.Store.set("SMART_CITY_LIST",n)}e.renderHTML()},error:function(){e.renderHTML()}})},renderHTML:function(){var e=i.Store.get("SMART_CITY_LIST");e&&e.length>0&&this.els.cityContainer.html(this.citylistTplFun({data:e})).show();var t=i.Store.get("LOCATION_CITY");this.els.locationContainer.html(this.locationTplFun({data:t})).show()},formatData:function(e){var t=i.Store.get("SMART_SELECTED_CITY"),n=e,r=new Array,s=[],o=[],u=t&&t.id?t.id:null;return _.each(n,function(e,t){var n=e.pinyin.substr(0,1).toUpperCase();$.inArray(n,r)==-1&&(r.push(n),s[n]=[]),u&&u==e.id&&(e.selected=!0),s[n].push(e)}),r.sort(),_.each(r,function(e,t){o.push({key:e,value:s[e]})}),o},onInit:function(){this.$el.html(t),this.els={cityContainer:this.$el.find("#js_cityContainer"),locationContainer:this.$el.find("#js_locationContainer"),citylistTpl:this.$el.find("#citylist_tpl"),locationTpl:this.$el.find("#location_tpl")},this.citylistTplFun=_.template(this.els.citylistTpl.html()),this.locationTplFun=_.template(this.els.locationTpl.html()),this.requestCityList()},onShow:function(){},onHide:function(){}});return o})