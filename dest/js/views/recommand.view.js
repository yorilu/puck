define(["backbone","text!../templates/recommand.tpl.html","puck","baseview","utils","modelFactory","callback","deferred","videoPlayer"],function(e,t,n,r,i,s,o,u){var a=i.Date,f=s.get("gamesModel"),l=s.get("getTopNVideo"),c=r.extend({events:{"click #js_goTopVideo":"goTopVideo","click #js_goGames":"goGames","click .js_download":"goDownload","click .js_goFeedback":"goFeedback","click #js_videoContainer li":"clickVideo","click .js_game":"goNextPage"},goTopVideo:function(){n.go("topvideo")},goGames:function(){$("#js_gameTab").click()},goFeedback:function(){n.go("feedback")},goDownload:function(){i.downloadApp()},goNextPage:function(e){var t=$(e.currentTarget),r=t.data("gameid"),s=t.data("status"),o=t.data("path"),u=t.data("title");s=="0"?alert("比赛尚未开始,请稍后重试!"):s=="1"||s=="4"?(o=i.Util.rtmp2m3u8(o),this.player.setSrc(o),this.player.setTitle(u),this.player.play(),this.player.enterFullScreen()):(s=="2"||s=="3")&&n.go("/game/"+r)},clickVideo:function(e){var t=$(e.currentTarget),n=t.attr("data-path"),r=t.attr("data-title");n&&(this.player.setSrc(n),this.player.setTitle(r),this.player.play(),this.player.enterFullScreen())},requestGames:function(e){var t=this;t.now=i.Date.dateFormat(new Date,"yyyy-MM-dd hh:mm:ss");var n=f.$post({data:{clientId:"h5",startDate:t.now,upDown:"down",pageSize:2,pageIndex:1},success:function(){}}),r=f.$post({data:{clientId:"h5",startDate:t.now,upDown:"up",pageSize:2,pageIndex:1},success:function(){}});$.when(n,r).done(function(e,n){var r=e[0]&&e[0].code==0&&e[0].data&&e[0].data.length>0?e[0].data:[],s=n[0]&&n[0].code==0&&n[0].data&&n[0].data.length>0?n[0].data:[],o=r.concat(s);if(o&&o.length>0){var u=i.Date.str2mm(t.now);for(var a=0,f=o.length;a<f;a++){var l=i.Date.str2mm(o[a].startTime)-u;o[a].diff=l<0?0-l:l}function c(e,t){return e.diff-t.diff}var h=o.sort(c);t.els.gamesContainer.html(t.gameTplFun({data:h.slice(0,2)})).show()}})},requestVideos:function(){var e=this;l.$post({data:{clientId:"h5",pageSize:4,pageIndex:1,level:"5"},success:function(t){t&&t.data&&e.els.videosContainer.html(e.videoTplFun({data:t.data})).show(),console.log(t)},error:function(){}})},onInit:function(){console.log("recommand init"),this.$el.html(t),!i.platform.os.isIOS&&!i.platform.os.isAndroid&&this.$el.find(".js_download").hide(),this.els={gamesContainer:this.$el.find("#js_gameContainer"),videosContainer:this.$el.find("#js_videoContainer"),gamesTpl:this.$el.find("#games_tpl"),videosTpl:this.$el.find("#videos_tpl")},this.gameTplFun=_.template(this.els.gamesTpl.html()),this.videoTplFun=_.template(this.els.videosTpl.html()),this.player=new MediaElementPlayer("#js_main_video",{features:["playpause","progress","current","fullscreen","titlebar"]})},onShow:function(){console.log("recommand show"),this.requestGames(),this.requestVideos()},onHide:function(){}});return c})