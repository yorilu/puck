define(["backbone","text!../templates/topvideo.tpl.html","puck","baseview","modelFactory","scroller","videoPlayer"],function(e,t,n,r,i,s){var o=i.get("getTopNVideo"),u=function(e){this.self=e};u.prototype={sportType:"",pageSize:20,pageIndex:1,iscomplete:!1,scrollAdapter:function(e,t){var n=this.self;e&&(t?this.addListRender(e):this.listRender(e))},errorEvt:function(){var e=this.self;this.iscomplete=!0,e.hideLoading()},listRender:function(e){var t=this.self;window.scrollTo(0,0),t.hideLoading(),e&&e.data&&e.data.length>0?(t.els.container.html(t.tplfun({data:e.data})).show(),this.iscomplete=!1):(t.els.container.html(t.els.notpl.html()),this.iscomplete=!0)},addListRender:function(e){var t=this.self;e&&e.data&&e.data.length>0?(t.els.container.append(t.tplfun({data:e.data})).show(),this.iscomplete=!1):this.iscomplete=!0}};var a=r.extend({events:{"click .js_type li":"selectType","click .js_back":"goBack","click #js_container li":"clickVideo"},clickVideo:function(e){var t=$(e.currentTarget),n=t.attr("data-path"),r=t.attr("data-title");n&&(this.player.setSrc(n),this.player.setTitle(r),this.player.play(),this.player.enterFullScreen())},goBack:function(){n.back()},onInit:function(){this.listHelper=new u(this),this.player=new MediaElementPlayer("#js_main_video",{features:["playpause","progress","current","fullscreen","titlebar"]})},onShow:function(){this.$el.html(t),this.els={container:this.$el.find("#js_container"),tpl:this.$el.find("#topvideo_tpl"),notpl:this.$el.find("#no_topvideo_tpl")},this.tplfun=_.template(this.els.tpl.html()),this.doRequest(),this.bingScroll()},bingScroll:function(){var e=this;e.myScrollHandler=new s(this.$el,{onScroll:function(t,n,r){if(t==-1||e.listHelper.iscomplete)return;n(),e.doRequest(!0,function(){r()})}})},selectType:function(e){var t=$(e.currentTarget);if(t.find("a").hasClass("tm-leng"))return;t.parent().find(".tm-leng").removeClass("tm-leng"),t.find("a").addClass("tm-leng"),this.listHelper.sportType=t.attr("data-value"),this.doRequest()},doRequest:function(e,t){var n=this;e?this.listHelper.pageIndex+=1:(this.showLoading(),this.listHelper.pageIndex=1),console.log(this.listHelper.pageIndex),o.$post({data:{clientId:"h5",sportType:this.listHelper.sportType,pageSize:this.listHelper.pageSize,pageIndex:this.listHelper.pageIndex,level:"5"},success:function(r){n.listHelper.scrollAdapter(r,e),console.log(r),t&&t()},error:function(){t&&t()}})},onHide:function(){this.myScrollHandler.destroy()}});return a})